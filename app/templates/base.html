<!DOCTYPE html>
<html lang="{{ get_locale() if get_locale is defined else 'pl' }}" translate="no" class="notranslate">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token() if csrf_token is defined else '' }}">
  <!-- Opt-out of Google/Chrome auto-translation to avoid CSP-blocked injected assets -->
  <meta name="google" content="notranslate">
  <title>{% block title %}NexuSphere{% endblock %}</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">

  <!-- Removed inline theme bootstrap script; theme-dark class applied directly on <html>. -->

  <!-- CSS -->
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  {% block head %}{% endblock %}
  <!-- Core app styles (load early to avoid FOUC) -->

  <!-- Core app styles (load early to avoid FOUC) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}?v=10">

  {% block extra_css %}{% endblock %}
</head>
<body class="{% if current_user.is_authenticated %}has-sidebar {% endif %}" {% if project is defined %}data-project-id="{{ project.id }}" data-project-public-id="{{ project.public_id }}"{% endif %}>
  <div class="app-root">
    <!-- Sidebar: sibling to main so CSS can position it fixed on wide screens -->
    {% if current_user.is_authenticated %}
  <aside class="modern-sidebar" role="navigation" aria-label="Main sidebar">
      <div class="sidebar-header px-3 py-3 d-flex align-items-center">
        <h5 class="mb-0 d-flex align-items-center">
          <img src="{{ url_for('static', filename='favicon.svg') }}" alt="Logo" class="brand-logo me-2" width="40" height="40" />
          NexuSphere
        </h5>
      </div>

      <div class="sidebar-nav">
        <nav class="nav nav-pills flex-column px-2 py-2">
        {% if current_user.is_admin %}
          <a href="{{ url_for('admin.dashboard') }}" class="nav-link"><i class="material-icons me-2">dashboard</i> Panel Admina</a>
          <a href="{{ url_for('admin.projects') }}" class="nav-link"><i class="material-icons me-2">apartment</i> Budynki</a>
          <a href="{{ url_for('admin.users') }}" class="nav-link"><i class="material-icons me-2">people</i> UÅ¼ytkownicy</a>
          {% if current_user.is_superadmin %}
            <a href="{{ url_for('admin.experimental') }}" class="nav-link"><i class="material-icons me-2">science</i> Eksperymentalne</a>
          {% endif %}
        {% else %}
          <a href="{{ url_for('main.dashboard') }}" class="nav-link"><i class="material-icons me-2">home</i> Dashboard</a>
        {% endif %}
        </nav>
      </div>

      <div class="sidebar-footer px-3 py-3 d-flex flex-column gap-2">
  <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger btn-sidebar btn-sm w-100 d-flex align-items-center justify-content-center gap-1"><i class="material-icons fs-16">logout</i><span>Wyloguj</span></a>
      </div>
    </aside>
    {% endif %}

    <!-- Main content -->
    <main class="main-content">
      {# top utility bar removed per request #}
      <!-- Flash messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert {{ 'alert-danger' if category == 'error' else 'alert-info' }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Bootstrap bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" nonce="{{ csp_nonce() }}"></script>
  <!-- Core UI helpers (progress bars, dark theme initialization) -->
  <script src="{{ url_for('static', filename='js/theme.js') }}" nonce="{{ csp_nonce() }}" defer></script>
  <!-- Shared sanitization helpers for dynamic HTML insertion -->
  <script src="{{ url_for('static', filename='js/lib/sanitize.js') }}" nonce="{{ csp_nonce() }}" defer></script>
  <!-- Global toast utility (shared showToast) -->
  <script src="{{ url_for('static', filename='js/ui/toast.js') }}" nonce="{{ csp_nonce() }}" defer></script>

  {% block scripts %}{% endblock %}
</body>
</html>

